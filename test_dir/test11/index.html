<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Canvas Grayscale</title>
</head>
<body>

<input type="file" id="file">
<br><br>
<canvas id="canvas"></canvas>
<br><br>
<button id="btn">apasa</button>

<script>
    const file = document.getElementById("file");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    let img = new Image();

    file.addEventListener("change", () => {
        const reader = new FileReader();

        reader.onload = () => {
            img.onload = () => {
                canvas.width = img.naturalWidth;
                canvas.height = img.naturalHeight;
                ctx.drawImage(img, 0, 0);
            };
            img.src = reader.result;
        };

        reader.readAsDataURL(file.files[0]);
    });

    const btn = document.getElementById("btn");

    btn.addEventListener("click", () => {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        for (let i = 0; i < data.length; i += 4) {
            const gray =
                0.299 * data[i] +
                0.587 * data[i + 1] +
                0.114 * data[i + 2];

            data[i]     = gray;
            data[i + 1] = gray;
            data[i + 2] = gray;
        }

        ctx.putImageData(imageData, 0, 0);
    });
</script>

</body>
</html>
